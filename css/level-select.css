#conways-story-mode {
    .levels-heading {
        margin: 0.5rem 0.5rem 0rem;
    }

    .levels-units-wrapper {
        width: fit-content;
        max-width: 100%;
        overflow-x: auto;
    }
    .levels-units-wrapper, .levels-lessons-wrapper {
        --gap-per-line: calc((100% - round(down, 100%, 4.5rem)) / 2);
        padding-top: 100rem;
        margin-top: -100rem;
    }
    .levels-lessons-wrapper {
        width: fit-content;
    }
    
    .levels-units, .levels-lessons {
        display: flex;
        list-style-type: none;
        padding: 0 var(--gap-per-line);
    }
    .levels-units {
        width: max-content;
        background:
            linear-gradient(
                90deg,
                var(--background-main-color) 0rem calc(var(--gap-per-line) + 2rem),
                transparent calc(var(--gap-per-line) + 2rem) calc(100% - var(--gap-per-line) - 2rem),
                var(--background-main-color) calc(100% - var(--gap-per-line) - 2rem) 100%
            ),
            repeating-linear-gradient(
                180deg,
                transparent 0rem 1.65rem,
                var(--gray) 1.65rem 1.85rem,
                transparent 1.85rem 3.5rem
            );
    }
    .levels-lessons {
        flex-wrap: wrap;
        background:
            repeating-linear-gradient(
                180deg,
                transparent 0rem 1.65rem,
                var(--gray) 1.65rem 1.85rem,
                transparent 1.85rem 3.5rem
            );
    }
    
    .levels-units li, .levels-lessons li {
        width: 2.5rem;
        height: 2.5rem;
        position: relative;
        margin: 0.5rem 1rem;
        font-size: 1.5rem;
        &:nth-child(n + 100) {
            font-size: 1.25rem;
        }
        z-index: 1;
        border-radius: 1.25rem;
        &:has(button.level:focus-visible) {
            outline: 0.125rem dashed var(--gray-70); /* gray-70 used instead of gray-50 because of contrast */
            outline-offset: 0.3125rem;
        }
    }
    button.level {
        --button-bg: var(--gray-5);
        border-radius: 1.25rem;
        width: 100%;
        height: 100%;
        text-align: center;
        line-height: 2.5rem;
        border: none;
        padding: 0rem;
        outline: 0.125rem solid var(--gray);
        &:focus-visible {
            outline: 0.125rem solid var(--gray);
            /* The real focus indicator is done on the surrounding li element */
        }
    }
    .levels-lessons li:is(:first-child, :last-child)::before {
        position: absolute;
        content: '';
        width: max(100vw, 20rem);
        height: 2rem;
        top: 0.25rem;
        background-color: var(--background-main-color);
        z-index: -1;
    }
    .levels-lessons li:first-child::before {
        right: 2.5rem;
    }
    .levels-lessons li:last-child::before {
        left: 2.5rem;
    }

    .level-tooltip {
        position: absolute;
        bottom: 3.75rem;
        text-align: center;
        font-size: 1.125rem;
        max-width: 14rem;
        min-width: 2.75rem;
        width: max-content;
        z-index: 20;
        line-height: 1.2;
        left: 50%;
        transform: translateX(-50%);
        background-color: var(--gray-5);
        padding: 0.375rem 0.625rem;
        border-radius: 0.625rem;
        display: none; /* Gets overwritten when hovered or focused */
    }
    .level-tooltip::after {
        position: absolute;
        content: '';
        left: calc(50% - 0.75rem);
        width: 1.5rem;
        height: 1.5rem;
        background-color: var(--gray-5);
        top: 100%;
        clip-path: polygon(0% 0%, 100% 0%, 50% 50%);
    }
    /* Show the tooltip if:
       1. The level is hovered
       2. The level is focused, and nothing else in the timeline is hovered */
    li:has(:hover) .level-tooltip,
    :is(.levels-units, .levels-lessons):not(:has(:hover)) li:has(:focus-visible) .level-tooltip {
        display: block;
    }
    
    li.level-locked {
        pointer-events: none;
    }
    li.level-locked::after {
        content: 'lock';
        font-family: 'Material Symbols Outlined';
        position: absolute;
        right: -0.4rem;
        top: -0.54rem;
        font-size: 1.25rem;
        line-height: 1;
        font-variation-settings: 'FILL' 1;
    }
}
